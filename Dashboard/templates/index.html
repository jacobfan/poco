{% extends "base.html" %}

{% block style %}
    td.num {
        text-align: right;
    }
    td.na {
        text-align: right;
    }
{% endblock %}

{% block head %}
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="{{STATIC_URL}}flot-0.7/excanvas.min.js"></script><![endif]-->
<script src="{{STATIC_URL}}flot/jquery.flot.js" type="text/javascript"></script>
<script type="text/javascript">
    function fillChart(site_id, statistics) {
        var d1 = [];
        var ticks = [];
        $.each(statistics, function(idx, stat_row) {
            d1.push([idx, stat_row.PV_V]);
            ticks.push([idx, stat_row["date"]]);
        });
            
        var options = {
            lines: {show: true},
            points: {show: true },
            xaxis: {
                ticks: ticks,
            }
        };

        $.plot($("#chart-" + site_id), [d1], options);
    };

    function updateSiteStatistics(site_ids_array) {
        var site_ids_str = site_ids_array.join(',');
        $.getJSON("/ajax/get_site_statistics", {"site_ids_str": site_ids_str},
                function(data, textStatus, jqXHR) {
                    $.each(data, function(idx, site_data) {
                        $("#items-count-" + site_data.site_id).html(site_data["items_count"]);
                        fillChart(site_data.site_id, site_data.statistics);
                    });
                }
            );
    };
    
    $(function() {
        $("#accordion").accordion();
        {% for site in sites %}
            $("#sitetab-{{site.site_id}}").tabs();
        {% endfor %}
        
    });
</script>
{% endblock %}

{% block content-area %}
<div id="accordion">
    {% for site in sites %}
    <h3><a href="#">{{site.site_name}}</a></h3>
    <div>
        收录商品数：<span id="items-count-{{site.site_id}}">N/A</span>
        <div id="sitetab-{{site.site_id}}">
            <ul>
            <li><a href="#sitetab-{{site.site_id}}-chart">商品图表</a></li>
            <li><a href="#sitetab-{{site.site_id}}-2"> 查看商品列表</a></li>
            <li><a href="#sitetab-{{site.site_id}}-3">编辑商品分类组别</a></li>
            </ul>
            <div id="sitetab-{{site.site_id}}-chart">
                <table>
                <tr><th>时间段</th><th>商品PV</th><th>商品UV</th><th>PV/UV</th><th>订单数</th>
                    <th>推荐请求数</th><th>推荐点击数</th></tr>
                    {% for stat_row in site.statistics %}
                    {% if stat_row.is_available %}
                        <tr>
                    <td>{{stat_row.date}}</td>
                    <td class="num">{{stat_row.PV_V}}</td>
                    <td class="num">{{stat_row.UV_V}}</td>
                    <td class="num">{{stat_row.PV_UV}}</td>
                    <td class="num">{{stat_row.PV_PLO}}</td>
                    <td class="num">{{stat_row.PV_Rec}}</td>
                        <td class="num">{{stat_row.ClickRec}}</td>
                        </tr>
                    {% else %}
                        <tr><td>{{stat_row.date}}</td><td class="na">--</td><td class="na">--</td><td class="na">--</td><td class="na">--</td><td class="na">--</td></tr>
                    {% endif %}
                    {% endfor %}
                </table>
                <div id="chart-{{site.site_id}}" style="width:600px;height:300px;"></div>
            </div>
            <div id="sitetab-{{site.site_id}}-2">
            </div>
            <div id="sitetab-{{site.site_id}}-3">
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
